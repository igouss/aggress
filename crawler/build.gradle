plugins {
    id "java"
    id "idea"
    id "net.ltgt.apt" version "0.6"
    id "com.github.ben-manes.versions" version "0.12.0"// gradle dependencyUpdates
}

ext {
    sourceCompatibility = JavaVersion.VERSION_1_8
    targetCompatibility = JavaVersion.VERSION_1_8
}

dependencies {
    compile "org.elasticsearch:elasticsearch:2.3.3"
    compile "org.jsoup:jsoup:1.9.2"
    compile "org.hibernate:hibernate-core:5.2.0.Final"
    compile "org.hibernate:hibernate-hikaricp:5.2.0.Final"
    compile "org.hibernate:hibernate-ehcache:5.2.0.Final"
    compile "org.hibernate:hibernate-validator:5.2.0.Final"
    compile "ch.qos.logback:logback-core:1.1.7"
    compile "ch.qos.logback:logback-classic:1.1.7"
    compile "org.glassfish.web:el-impl:2.2.1-b05"
    compile "org.postgresql:postgresql:9.4.1208"
    compile "com.impossibl.pgjdbc-ng:pgjdbc-ng:0.6"
    compile "com.internetitem:logback-elasticsearch-appender:1.2"
    compile "io.reactivex:rxjava:1.1.6"
    compile "org.reflections:reflections:0.9.10"
    compile "io.dropwizard.metrics:metrics-core:3.1.2"
    compile "org.elasticsearch:metrics-elasticsearch-reporter:2.2.0"
    compile "org.apache.commons:commons-collections4:4.1"
    compile "com.google.code.gson:gson:2.7"
    compile "commons-io:commons-io:2.5"
    compile "org.asynchttpclient:async-http-client:2.0.9"
    compile "org.glassfish.grizzly:grizzly-websockets:2.3.25"
    compile "junit:junit:4.12"
    compile "org.jooq:jooq:3.8.2"
    compile "io.vertx:vertx-core:3.3.0"
    compile "com.h2database:h2:1.4.192"
    compile "net.sf.jopt-simple:jopt-simple:5.0.2"
    compile "com.google.dagger:dagger:2.5"
    compile "net.ltgt.gradle:gradle-apt-plugin:0.6"
    compile "com.google.dagger:dagger-compiler:2.5"
    compile "biz.paluch.redis:lettuce:4.2.1.Final"
    compile "org.apache.commons:commons-pool2:2.4.2"
    compile "org.apache.kafka:kafka-clients:0.10.0.0"
    compile "com.github.davidmoten:rxjava-slf4j:0.6.2" // https://github.com/davidmoten/rxjava-slf4j
    compile "com.github.davidmoten:rxjava-extras:0.7.9.9" // https://github.com/davidmoten/rxjava-extras
    apt "com.google.dagger:dagger-compiler:2.5"
}

javadoc {
    options {
        windowTitle = "Aggress Crawler Javadoc ${project.version}"
    }
}

test {
    testLogging.showStandardStreams = true;
    testLogging.showStackTraces = true;
    testLogging.showCauses = true;
    testLogging.showExceptions = true;
    maxParallelForks = 5
    forkEvery = 50
    include "**/Test*.*"
//    useTestNG()
}

task integrationTest(type: Test, dependsOn: "test") << {
    include "**/IntegrationTest*.*"
}


test.onlyIf {
    description = "gradle -Dcrawler.test=true"
    System.properties["crawler.test"] == "true"
}

task copyLibs(type: Copy) {
    group = "Publishing"
    description = "Copy app and all dependencies to build/libs"
    from configurations.compile
    into "$buildDir/libs"
    dependsOn jar
}
