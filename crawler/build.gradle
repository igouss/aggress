plugins {
    id "net.ltgt.apt" version "0.6"
}

apply plugin: 'java'
apply plugin: 'maven'

dependencies {
    compile 'org.elasticsearch:elasticsearch:2.2.0'
    compile 'org.jsoup:jsoup:1.8.3'
    compile group: 'org.hibernate', name: 'hibernate-core', version: '5.0.2.Final'
    compile group: 'org.hibernate', name: 'hibernate-hikaricp', version: '5.0.2.Final'
    compile group: 'org.hibernate', name: 'hibernate-ehcache', version: '5.0.2.Final'
    compile group: 'org.hibernate', name: 'hibernate-validator', version: '5.0.2.Final'
    compile 'ch.qos.logback:logback-core:1.1.3'
    compile 'ch.qos.logback:logback-classic:1.1.3'
    compile group: 'org.glassfish.web', name: 'el-impl', version: '2.2.1-b05'
    compile group: 'org.postgresql', name: 'postgresql', version: '9.4-1201-jdbc41'
    compile group: 'com.impossibl.pgjdbc-ng', name: 'pgjdbc-ng', version: '0.5'
//    compile group: 'com.zaxxer', name: 'HikariCP', version: '2.+'
    compile group: 'com.internetitem', name: 'logback-elasticsearch-appender', version: '1.2'


    compile group: 'io.reactivex', name: 'rxjava', version: '1.1.3'
//    compile group: 'io.reactivex', name: 'rxjava-async-util', version: '0.21.0'
//    compile group: 'io.reactivex', name: 'rxjava-computation-expressions', version: '0.21.0'
//    compile group: 'io.reactivex', name: 'rxjava-debug', version: '1.0.1'
//    compile group: 'io.reactivex', name: 'rxjava-joins', version: '0.22.0'
//    compile group: 'io.reactivex', name: 'rxjava-math', version: '1.0.0'
//    compile group: 'io.reactivex', name: 'rxjava-reactive-streams', version: '1.0.1'
//    compile group: 'io.reactivex', name: 'rxjava-string', version: '1.0.1'
    compile group: 'org.reflections', name: 'reflections', version: '0.9.10'
    compile group: 'io.dropwizard.metrics', name: 'metrics-core', version: '3.1.2'
    compile group: 'org.elasticsearch', name: 'metrics-elasticsearch-reporter', version: '2.0'
    compile group: 'org.apache.commons', name: 'commons-collections4', version: '4.0'
    compile group: 'com.google.code.gson', name: 'gson', version: '2.3.1'
    compile group: 'commons-io', name: 'commons-io', version: '2.4'

    compile group: 'com.ning', name: 'async-http-client', version: '1.9.33'
    compile group: 'org.glassfish.grizzly', name: 'grizzly-websockets', version: '2.3.23'
    compile 'com.netflix.rxjava:rxjava-apache-http:0.20.7'
    // testCompile 'org.testng:testng:6.0.1'
    compile 'junit:junit:4.12'
    compile 'org.jooq:jooq:3.7.1'
    compile 'io.vertx:vertx-core:3.1.0'
    compile 'com.h2database:h2:1.3.176'
    compile 'net.sf.jopt-simple:jopt-simple:4.9'
    compile 'com.google.dagger:dagger:2.1'
    compile "net.ltgt.gradle:gradle-apt-plugin:0.6"
    compile 'com.google.dagger:dagger-compiler:2.1'
    compile 'biz.paluch.redis:lettuce:4.1.1.Final'
    compile 'org.apache.kafka:kafka-clients:0.9.0.0'
    apt 'com.google.dagger:dagger-compiler:2.1'
}

sourceSets {
    main {
        java {
            srcDir 'src/main/generated'
        }
    }
}

test {
    testLogging.showStandardStreams = true;
    testLogging.showStackTraces = true;
    testLogging.showCauses = true;
    testLogging.showExceptions = true;
    maxParallelForks = 5
    forkEvery = 50
    include '**/Test*.*'
//    useTestNG()
}

task integrationTest(type: Test, dependsOn: "test") << {
    include '**/IntegrationTest*.*'
}


test.onlyIf {
    description = 'gradle -Dcrawler.test=true'
    System.properties['crawler.test'] == 'true'
}

task copyLibs(type: Copy, dependsOn: clean) << {
    description = "Copy dependency files to build directory"
    into "build"
    from configurations.compile
}

task buildscriptDependencies << {
    description = "Print project's dependencies"
    buildscript.configurations.classpath.each { println it }
}

task crawler(type:JavaExec) {
    description = "Run crawler"
    main = "com.naxsoft.Aggress"
    classpath = sourceSets.main.runtimeClasspath
}

task crawlerjar(type: Jar) << {
    description = "Generate project jar file"
    manifest {
        attributes 'Implementation-Title': 'com.naxsoft.Aggress crawler',
                'Implementation-Version': version,
                'Built-By': System.getProperty('user.name'),
                'Built-Date': new Date(),
                'Built-JDK': System.getProperty('java.version'),
                'Main-Class': 'com.naxsoft.Aggress'
    }
    baseName = project.name + '-all'
    from { configurations.compile.collect { it.isDirectory() ? it : zipTree(it) } }
    with jar
}

configure(install.repositories.mavenInstaller) {
    pom.project {
        groupId 'com.naxsoft'
        artifactId 'aggress-crawler'
        version '1.0.0-SNAPSHOT'
        description = 'Aggress web crawler'
    }
}
